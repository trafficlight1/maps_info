<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Lviv 3D Map Visualization</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; background-color: #000; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 50px;
            border: 1px solid #333;
            z-index: 10;
        }

        .layer-btn {
            background: transparent;
            border: 1px solid #555;
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .layer-btn:hover {
            border-color: #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .layer-btn.active {
            background: #fff;
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

    </style>
</head>
<body>

<div id="map"></div>

<div class="controls">
    <button class="layer-btn" onclick="elevateLayer('parks')">Парки</button>
    <button class="layer-btn" onclick="elevateLayer('streets')">Магістралі</button>
    <button class="layer-btn" onclick="elevateLayer('housing')">Історичний ареал</button>
</div>


<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibHZpdiIsImEiOiJjbWl4MXQ0dG4wMmRoM2VzNzZvMzlmODVmIn0.FpjKdCBZR8neb-2imEu-xA';
    const map = new mapboxgl.Map({
        container: 'map',
        style: {
            "version": 8,
            "name": "Dark Empty",
            "sources": {},
            "layers": [
                {
                    "id": "background",
                    "type": "background",
                    "paint": { "background-color": "#000" }
                }
            ]
        },
        center: [24.0311, 49.8329], // Львів
        zoom: 13.2,
        pitch: 45,
        bearing: 0,
        antialias: true,
        preserveDrawingBuffer: true,
        interactive: false
    });

    map.on('load', () => {
        
        map.addSource('parks-source', {
            type: 'geojson',
            data: './park.geojson' 
        });

        map.addLayer({
            'id': 'parks-layer',
            'type': 'fill-extrusion',
            'source': 'parks-source',
            'paint': {
                'fill-extrusion-color': '#00e676',
                'fill-extrusion-height': 10, 
                'fill-extrusion-base': 0,   
                'fill-extrusion-opacity': 0.8
            }
        });

        map.addSource('streets-source', {
            type: 'geojson',
            data: './roads.json.geojson'
        });

        map.addLayer({
            'id': 'streets-layer',
            'type': 'line', 
            'source': 'streets-source',
            'paint': {
                'line-color': '#42a5f5',
                'line-width': 4,
                'line-opacity': 0.9
            }
        });

        map.addSource('buildings-source', {
            type: 'geojson',
            data: './historical1.geojson'
        });

        map.addLayer({
            'id': 'buildings-layer',
            'type': 'fill-extrusion',
            'source': 'buildings-source',
            'paint': {
                'fill-extrusion-color': '#FFB74D',
                'fill-extrusion-height': ['get', 'height'], 
                'fill-extrusion-base': 0,
                'fill-extrusion-opacity': 0.9
            }
        });


        map.setLight({
            anchor: 'viewport',
            color: 'white',
            intensity: 0.5,
            position: [1.15, 210, 30]
        });
    });
    function elevateLayer(layerName) {
        resetLayers();
        
        if (layerName === 'parks') {
            map.setPaintProperty('parks-layer', 'fill-extrusion-base', 0);
            map.setPaintProperty('parks-layer', 'fill-extrusion-height', 80); 
            setActiveButton(0);
        } 
        else if (layerName === 'streets') {
            console.log("Lines cannot be vertically offset in standard Mapbox without terrain hacks.");
            map.setPaintProperty('streets-layer', 'line-color', '#fff');
            map.setPaintProperty('streets-layer', 'line-width', 6);
            setActiveButton(1);
        } 
        else if (layerName === 'housing') {
            map.setPaintProperty('buildings-layer', 'fill-extrusion-base', 0);
             map.setPaintProperty('buildings-layer', 'fill-extrusion-height', 50);
            
            setActiveButton(2);
        }
    }

    function resetLayers() {
        if (map.getLayer('parks-layer')) {
            map.setPaintProperty('parks-layer', 'fill-extrusion-base', 0);
            map.setPaintProperty('parks-layer', 'fill-extrusion-height', 5);
        }

        if (map.getLayer('streets-layer')) {
            map.setPaintProperty('streets-layer', 'line-color', '#42a5f5');
            map.setPaintProperty('streets-layer', 'line-width', 3);
        }

        if (map.getLayer('buildings-layer')) {
            map.setPaintProperty('buildings-layer', 'fill-extrusion-base', 0);
            map.setPaintProperty('buildings-layer', 'fill-extrusion-height', 5); // Повертаємо базову висоту
        }
        
        document.querySelectorAll('.layer-btn').forEach(btn => btn.classList.remove('active'));
    }

    function setActiveButton(index) {
        const buttons = document.querySelectorAll('.layer-btn');
        buttons[index].classList.add('active');
    }

</script>

</body>
</html>


